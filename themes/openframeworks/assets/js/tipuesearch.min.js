function levenshtein(k,q,g,z,v){g=null==g?1:+g;z=null==z?1:+z;v=null==v?1:+v;if(k==q)return 0;var e=k.length,w=q.length;if(0===e)return w*g;if(0===w)return e*v;var l=!1;try{l=!"0"[0]}catch(A){l=!0}l&&(k=k.split(""),q=q.split(""));var l=Array(w+1),x=Array(w+1),t,m,c,n;for(m=0;m<=w;m++)l[m]=m*g;for(t=0;t<e;t++){x[0]=l[0]+v;for(m=0;m<w;m++)c=l[m]+(k[t]==q[m]?0:z),n=l[m+1]+v,n<c&&(c=n),n=x[m]+g,n<c&&(c=n),x[m+1]=c;m=l;l=x;x=m}return c=l[w]}
(function(k){k.fn.tipuesearch=function(q){var g=k.extend({show:20,newWindow:!1,showURL:!0,showTitleCount:!0,minimumLength:3,descriptiveWords:25,highlightTerms:!0,highlightEveryTerm:!1,mode:"static",liveDescription:"*",liveContent:"*",contentLocation:"tipuesearch/tipuesearch_content.json",debug:!1},q);return this.each(function(){function q(e){return decodeURIComponent(((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)")).exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function v(t,m){k("#tipue_search_content").hide();
k("#tipue_search_content").html('<div class="tipue_search_spinner"><div class="tipue_search_rect1"></div><div class="tipue_search_rect2"></div><div class="rect3"></div></div>');k("#tipue_search_content").show();var c="",n=!1,l=!1,b=!0,u=0;found=[];var f=k("#tipue_search_input").val().toLowerCase(),f=k.trim(f);if(f.match('^"')&&f.match('"$')||f.match("^'")&&f.match("'$"))b=!1;if(b){for(var p=f.split(" "),f="",a=0;a<p.length;a++){for(var q=!0,d=0;d<tipuesearch_stop_words.length;d++)p[a]==tipuesearch_stop_words[d]&&
(q=!1,l=!0);q&&(f=f+" "+p[a])}f=k.trim(f);p=f.split(" ")}else f=f.substring(1,f.length-1);if(f.length>=g.minimumLength){if(b){if(m){for(var z=f,a=0;a<p.length;a++)for(d=0;d<tipuesearch_replace.words.length;d++)p[a]==tipuesearch_replace.words[d].word&&(f=f.replace(p[a],tipuesearch_replace.words[d].replace_with),n=!0);p=f.split(" ")}l=f;for(a=0;a<p.length;a++)for(d=0;d<tipuesearch_stem.words.length;d++)p[a]==tipuesearch_stem.words[d].word&&(l=l+" "+tipuesearch_stem.words[d].stem);p=l.split(" ");for(a=
0;a<e.pages.length;a++){var q=b=0,y=e.pages[a].text,h=new RegExp(l,"gi");if(-1!=e.pages[a].text.search(h))var r=e.pages[a].text.match(h).length,b=b+20*r;for(d=0;d<p.length;d++){h=new RegExp(p[d],"gi");-1!=e.pages[a].title.search(h)&&(null!==e.pages[a].title.match("^"+h+"$")?b+=500:(r=e.pages[a].title.match(h).length,b+=40*r));g.highlightTerms&&(r=g.highlightEveryTerm?new RegExp("("+p[d]+")","gi"):new RegExp("("+p[d]+")","i"),y=y.replace(r,'<span class="h01">$1</span>'));tags=e.pages[a].tags.split(" ");
foundmatch=!1;type="";for(idx in tags)-1!=tags[idx].search(h)&&(null!==tags[idx].match("^"+h+"$")?b+=100:(r=tags[idx].match(h).length,b+=10*r)),"module"==tags[idx]&&(type="module"),"class"==tags[idx]&&(type="class"),"function"==tags[idx]&&(type="function"),distance=levenshtein(p[d],tags[idx]),q+=distance,0<distance?(distance/=Math.max(p[d].length,tags[idx].length),.5>distance?(foundmatch||(b+=100*(1-distance)),foundmatch=!0):b-=10*distance):(foundmatch||(b+=100),foundmatch=!0);foundmatch?("module"===
type&&(b+=30),"class"===type&&(b+=20),"function"===type&&(b+=10)):b-=20;if(-1!=e.pages[a].text.search(h))r=e.pages[a].text.match(h).length,b="module"===type?b+10*r:"class"===type?b+7*r:"function"===type?b+5*r:b+3*r;else{foundmatch=!1;words=e.pages[a].text.replace("<br/>"," ").split(" ");for(idx in words)2>levenshtein(p[d],words[idx])&&(b+=2,foundmatch=!0);foundmatch||(b-=5)}-1!=e.pages[a].url.search(h)&&(b+=20);if(0!=b)for(h=0;h<tipuesearch_weight.weight.length;h++)e.pages[a].url==tipuesearch_weight.weight[h].url&&
(b+=tipuesearch_weight.weight[h].score);p[d].match("^-")&&(h=new RegExp(p[d].substring(1),"i"),-1!=e.pages[a].title.search(h)||-1!=e.pages[a].text.search(h)||-1!=e.pages[a].tags.search(h))&&(b=0)}50<b&&(found.push({score:b,tags_distance:q,title:e.pages[a].title,desc:y,url:e.pages[a].url}),u++)}}else for(a=0;a<e.pages.length;a++){b=0;y=e.pages[a].text;h=new RegExp(f,"gi");-1!=e.pages[a].title.search(h)&&(r=e.pages[a].title.match(h).length,b+=100*r);-1!=e.pages[a].text.search(h)&&(r=e.pages[a].text.match(h).length,
b+=20*r);g.highlightTerms&&(r=g.highlightEveryTerm?new RegExp("("+f+")","gi"):new RegExp("("+f+")","i"),y=y.replace(r,'<span class="h01">$1</span>'));-1!=e.pages[a].tags.search(h)&&(r=e.pages[a].tags.match(h).length,b+=50*r);-1!=e.pages[a].url.search(h)&&(b+=20);if(0!=b)for(h=0;h<tipuesearch_weight.weight.length;h++)e.pages[a].url==tipuesearch_weight.weight[h].url&&(b+=tipuesearch_weight.weight[h].score);0!=b&&(found.push({score:b,tags_distance:0,title:e.pages[a].title,desc:y,url:e.pages[a].url}),
u++)}if(0!=u){g.showTitleCount&&0==w&&(document.title="("+u+") "+document.title,w++);1==n&&(c+='<div id="tipue_search_warning">'+tipuesearch_string_2+" "+f+". "+tipuesearch_string_3+' <a id="tipue_search_replaced">'+z+"</a></div>");1==u?c+='<div id="tipue_search_results_count">'+tipuesearch_string_4+"</div>":(c_c=u.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),c+='<div id="tipue_search_results_count">'+c_c+" "+tipuesearch_string_5+"</div>");found.sort(function(a,b){return b.score-a.score});for(a=
n=0;a<found.length;a++){if(n>=t&&n<g.show+t&&(c+='<div class="tipue_search_content_title"><a href="'+found[a].url+'"'+x+">"+found[a].title+"</a></div>",g.debug&&(c+='<div class="tipue_search_content_debug">Score: '+found[a].score+"</div>",c+='<div class="tipue_search_content_debug">Distance: '+found[a].tags_distance+"</div>"),g.showURL&&(d=found[a].url.toLowerCase(),0==d.indexOf("http://")&&(d=d.slice(7)),c+='<div class="tipue_search_content_url"><a href="'+found[a].url+'"'+x+">"+d+"</a></div>"),
found[a].desc)){d=found[a].desc;f="";p=d.split(" ");if(p.length<g.descriptiveWords)f=d;else for(d=0;d<g.descriptiveWords;d++)f+=p[d]+" ";f=k.trim(f);"."!=f.charAt(f.length-1)&&(f+=" ...");c+='<div class="tipue_search_content_text">'+f+"</div>"}n++}if(u>g.show){u=Math.ceil(u/g.show);a=t/g.show;c+='<div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">';0<t&&(c+='<li><a class="tipue_search_foot_box" id="'+(t-g.show)+"_"+m+'">'+tipuesearch_string_6+"</a></li>");2>=a?(n=u,3<u&&(n=3),d=0):(n=a+
2,n>u&&(n=u),d=a-1);for(;d<n;d++)c=d==a?c+('<li class="current">'+(d+1)+"</li>"):c+('<li><a class="tipue_search_foot_box" id="'+d*g.show+"_"+m+'">'+(d+1)+"</a></li>");a+1!=u&&(c+='<li><a class="tipue_search_foot_box" id="'+(t+g.show)+"_"+m+'">'+tipuesearch_string_7+"</a></li>");c+="</ul></div>"}}else c+='<div id="tipue_search_warning">'+tipuesearch_string_8+"</div>"}else l?c+='<div id="tipue_search_warning">'+tipuesearch_string_8+". "+tipuesearch_string_9+"</div>":(c+='<div id="tipue_search_warning">'+
tipuesearch_string_10+"</div>",c=1==g.minimumLength?c+('<div id="tipue_search_warning">'+tipuesearch_string_11+"</div>"):c+('<div id="tipue_search_warning">'+tipuesearch_string_12+" "+g.minimumLength+" "+tipuesearch_string_13+"</div>"));k("#tipue_search_content").hide();k("#tipue_search_content").html(c);k("#tipue_search_content").slideDown(200);k("#tipue_search_replaced").click(function(){v(0,!1)});k(".tipue_search_foot_box").click(function(){var a=k(this).attr("id").split("_");v(parseInt(a[0]),
a[1])})}var e={pages:[]};k.ajaxSetup({async:!1});var w=0;if("live"==g.mode)for(var l=0;l<tipuesearch_pages.length;l++)k.get(tipuesearch_pages[l]).done(function(t){var m=k(g.liveContent,t).text(),m=m.replace(/\s+/g," "),c=k(g.liveDescription,t).text(),c=c.replace(/\s+/g," "),n=t.toLowerCase().indexOf("<title>"),q=t.toLowerCase().indexOf("</title>",n+7);t=-1!=n&&-1!=q?t.slice(n+7,q):tipuesearch_string_1;e.pages.push({title:t,text:c,tags:m,url:tipuesearch_pages[l]})});"json"==g.mode&&k.getJSON(g.contentLocation).done(function(g){e=
k.extend({},g)});"static"==g.mode&&(e=k.extend({},tipuesearch));var x="";g.newWindow&&(x=' target="_blank"');q("q")&&(k("#tipue_search_input").val(q("q")),v(0,!0));k(this).keyup(function(e){"13"==e.keyCode&&v(0,!0)})})}})(jQuery);
